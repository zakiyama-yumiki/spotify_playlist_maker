# MVP実装タスク一覧

## コミット1: 開発環境とプロジェクト基盤整備

- 作業範囲
  - フロントエンド: Vite + React テンプレート初期化、TypeScript 有効化、ESLint/Prettier 設定
  - サーバ: Hono + Cloudflare Workers 向けセットアップ、ローカル開発スクリプト追加
  - パッケージマネージャ設定（pnpm など）と共通スクリプト整備
- [✖]完了条件
  - `pnpm dev` でフロントと API モックが同時に起動
  - Lint/format コマンドが動作し、CI 用スクリプト定義済み

## コミット2: セットリストパーサと正規化ユーティリティ

- 作業範囲
  - 入力テキストの行分割、番号/記号除去、Encore セクション識別
  - タイトル正規化（全角半角変換・括弧タグ抽出・非楽曲行除外）
  - 単体テストで代表パターンを網羅
- 完了条件
  - 仕様例の入力から期待される配列構造が得られる
  - 非楽曲行が設定に応じて除外/保持されることをテストで確認

## コミット3: Spotify OAuth (PKCE) フロー実装

- 作業範囲
  - Authorization Code with PKCE のリダイレクトハンドラとトークン交換処理
  - 必要スコープ `playlist-modify-private` / `playlist-modify-public` の同意画面
  - セッション/KV ストレージへのトークン保存と更新ロジック
- 完了条件
  - ローカル開発環境で Spotify アカウントと連携し、アクセストークンが取得・更新できる
  - 認可エラー時のユーザー向けメッセージ表示

## コミット4: アーティスト解決サービス実装

- 作業範囲
  - 入力アーティスト名の検証と Spotify Artist ID 取得 API クライアント
  - バリデーションエラーや複数ヒット時のハンドリング
  - 単体テスト（API レスポンスモック）
- 完了条件
  - Artist 名から ID が取得でき、未ヒット時にエラーを返す
  - UI で入力エラーが明示される

## コミット5: 楽曲検索・一致判定ロジック

- 作業範囲
  - 厳密一致 → バリアント優先 → ISRC → ゆるめ一致のスコアリング実装
  - `market=from_token` 対応と地域不可時の代替候補取得
  - 上位3件候補の整形とログ出力
- 完了条件
  - 正規化済み入力に対し、期待順序で URI / 候補配列が返る
  - ログに一致率とリトライ情報が記録される

## コミット6: プレイリスト生成オーケストレーション

- 作業範囲
  - 100曲単位の分割追加、公開/非公開オプション設定
  - 429/5xx 時のリトライと指数バックオフ
  - 完了メタデータ（所要時間・一致率）の生成
- 完了条件
  - 30曲・120曲ケースで順序保持を確認する自動テスト
  - エラーパスで部分結果と再実行キューが返却される

## コミット7: 入力画面（画面A）UI 実装

- 作業範囲
  - Artist 入力、セットリストテキストエリア、公開設定、重複除去・バージョン優先度オプション
  - フォームバリデーションと実行ボタンの状態管理
  - API 呼び出しとの連携と進捗表示
- 完了条件
  - 必須項目未入力時にエラー表示し、送信しない
  - 成功時に結果画面へステートを引き継ぐ

## コミット8: 結果画面（画面B）と未一致候補 UI

- 作業範囲
  - 成功リスト表示（順序/トラック情報/合計時間）
  - 未一致カードに候補上位3件の表示と選択 → 再適用アクション
  - 「Spotify で開く」リンクと一括操作ボタン
- 完了条件
  - 候補選択後に再リクエストが発火し、結果が反映される
  - 未一致をスキップしてもプレイリストが完成する

## コミット9: エラーハンドリング・ロギング強化

- 作業範囲
  - 共通エラートースト/モーダル、タイムアウト時の案内
  - 429/5xx/未一致ケースのユーザー通知
  - サーバ側で一致率・処理時間・API リトライ回数を構造化ログ出力
- 完了条件
  - 想定エラーケースでユーザーに状況と再試行手段が提示される
  - Cloudflare Logs へ必要メトリクスが出力される

## コミット10: テスト整備とCI

- 作業範囲
  - パーサ・一致判定の単体テスト補完、統合テストで30/50/120曲シナリオ
  - モック Spotify API を用いた E2E テスト準備
  - CI ワークフローで lint/test を自動化
- 完了条件
  - テストがグリーンで CI が成功
  - 代表シナリオで自動マッチ率90%以上を検証

## コミット11: デプロイ設定とドキュメント

- 作業範囲
  - Cloudflare Workers へのデプロイ設定（wrangler.toml 等）
  - 環境変数とSpotifyアプリ設定手順の README 追記
  - リリースノート雛形作成
- 完了条件
  - `pnpm deploy` で本番相当環境へデプロイ可能
  - README にセットアップ〜デプロイ手順が明記されている
